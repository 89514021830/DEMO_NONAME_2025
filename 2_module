–ß—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ –ú–æ–¥—É–ª–µ 2:
1. BR-SRV ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Samba-–¥–æ–º–µ–Ω–∞
‚Ä¢	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Samba –≤ —Ä–µ–∂–∏–º–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞.
‚Ä¢	–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É hq, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π user1.hq‚Äìuser5.hq.
‚Ä¢	–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø—É hq.
‚Ä¢	–†–∞–∑—Ä–µ—à–∏—Ç—å –∏–º –≤—Ö–æ–¥ –Ω–∞ HQ-CLI.
‚Ä¢	–í—ã–¥–∞—Ç—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ cat, grep, id —Å –ø–æ–º–æ—â—å—é sudoers.
‚Ä¢	–í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ /opt/users.csv.
2. HQ-SRV ‚Äî RAID5 + NFS
‚Ä¢	–ù–∞ 3 –¥–∏—Å–∫–∞—Ö –ø–æ 1–ì–ë —Å–æ–∑–¥–∞—Ç—å RAID5 /dev/md0.
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ—Å–±–æ—Ä–∫—É —á–µ—Ä–µ–∑ /etc/mdadm.conf, —Ç–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è /raid5.
‚Ä¢	–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ext4, –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ /etc/fstab.
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å NFS-—Å–µ—Ä–≤–µ—Ä, —Ä–∞—Å—à–∞—Ä–∏—Ç—å /raid5/nfs –Ω–∞ HQ-CLI —Å –ø–æ–ª–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º.
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ HQ-CLI –≤ /mnt/nfs.
3. HQ-RTR ‚Äî Chrony (NTP-—Å–µ—Ä–≤–µ—Ä)
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å chrony –Ω–∞ HQ-RTR –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä (stratum 5).
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å HQ-SRV, HQ-CLI, BR-RTR, BR-SRV –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç—ã.
4. BR-SRV ‚Äî Ansible
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Ansible –≤ /etc/ansible.
‚Ä¢	–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å: HQ-SRV, HQ-CLI, HQ-RTR, BR-RTR.
‚Ä¢	–ü—Ä–æ–≤–µ—Ä–∫–∞: ansible all -m ping –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç pong –±–µ–∑ –æ—à–∏–±–æ–∫.
5. BR-SRV ‚Äî Docker (MediaWiki)
‚Ä¢	–°–æ–∑–¥–∞—Ç—å ~/wiki.yml.
‚Ä¢	–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å MediaWiki + MariaDB —á–µ—Ä–µ–∑ docker compose.
o	–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä wiki ‚Äî –æ–±—Ä–∞–∑ mediawiki, –º–æ–Ω—Ç–∏—Ä—É–µ—Ç ~/LocalSettings.php.
o	–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä mariadb, –ë–î mediawiki, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å wiki, –ø–∞—Ä–æ–ª—å WikiP@ssw0rd.
‚Ä¢	–ü–æ—Ä—Ç: –≤–Ω–µ—à–Ω–∏–π 8080.
6. HQ-RTR –∏ BR-RTR ‚Äî –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤
‚Ä¢	HQ-RTR: 2024 ‚Üí HQ-SRV:2024
‚Ä¢	BR-RTR:
o	2024 ‚Üí BR-SRV:2024
o	80 ‚Üí BR-SRV:8080
7. HQ-SRV ‚Äî Moodle
‚Ä¢	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Apache, MariaDB.
‚Ä¢	–°–æ–∑–¥–∞—Ç—å –ë–î moodledb, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å moodle, –ø–∞—Ä–æ–ª—å P@ssw0rd.
‚Ä¢	–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Moodle: P@ssw0rd.
‚Ä¢	–ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ Moodle ‚Äî –Ω–æ–º–µ—Ä —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞ (–∞—Ä–∞–±—Å–∫–∞—è —Ü–∏—Ñ—Ä–∞).
8. HQ-RTR ‚Äî nginx (–æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏)
‚Ä¢	moodle.au-team.irpo ‚Üí HQ-SRV:80
‚Ä¢	wiki.au-team.irpo ‚Üí BR-SRV:8080
9. HQ-CLI ‚Äî –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä–∞
‚Ä¢	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π Yandex Browser.
‚Ä¢	–û—Ç–º–µ—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –≤ –æ—Ç—á—ë—Ç–µ.
–®–∞–≥ 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Samba-–¥–æ–º–µ–Ω–∞ –Ω–∞ BR-SRV
üìç –ó–∞–¥–∞—á–∞:
1.	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Samba –≤ —Ä–µ–∂–∏–º–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞.
2.	–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π user1.hq‚Äìuser5.hq, –≥—Ä—É–ø–ø—É hq.
3.	–í–≤–µ—Å—Ç–∏ –≤ –¥–æ–º–µ–Ω –º–∞—à–∏–Ω—É HQ-CLI.
4.	–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≥—Ä—É–ø–ø—ã hq:
o	–≤—Ö–æ–¥ –Ω–∞ HQ-CLI;
o	–∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ cat, grep, id —Å –ø—Ä–∞–≤–∞–º–∏ sudo.
5.	–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ñ–∞–π–ª–∞ /opt/users.csv.
________________________________________
‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
–ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞–ª–∏—á–∏–µ –ø–∞–∫–µ—Ç–æ–≤:
sudo apt update
sudo apt install samba krb5-config winbind libpam-winbind libnss-winbind -y
________________________________________
üîß 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ /etc/samba/smb.conf:
–ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞:
 [global]
   workgroup = AU-TEAM
   realm = AU-TEAM.IRPO
   netbios name = BR-SRV
   server role = active directory domain controller
   dns forwarder = 8.8.8.8
   idmap_ldb:use rfc2307 = yes

[netlogon]
   path = /var/lib/samba/sysvol/au-team.irpo/scripts
   read only = no

[sysvol]
   path = /var/lib/samba/sysvol
   read only = no
________________________________________
üîß 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–º–µ–Ω–∞:
sudo samba-tool domain provision --use-rfc2307 --interactive
–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã:
‚Ä¢	Realm: AU-TEAM.IRPO
‚Ä¢	Domain: AU-TEAM
‚Ä¢	Server Role: dc
‚Ä¢	DNS backend: SAMBA_INTERNAL
‚Ä¢	Administrator password: –ó–∞–¥–∞–π –Ω–∞–¥—ë–∂–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, P@ssw0rd)
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–º–µ–Ω–∏ smbd –∏ nmbd –Ω–∞ samba:
sudo systemctl stop smbd nmbd winbind
sudo systemctl disable smbd nmbd winbind
sudo systemctl enable samba-ad-dc --now
________________________________________
üîß 3. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≥—Ä—É–ø–ø—ã:
sudo samba-tool group add hq
for i in {1..5}; do
  sudo samba-tool user create user$i.hq P@ssw0rd
  sudo samba-tool group addmembers hq user$i.hq
done

4. –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è sudo:
–ù–∞ HQ-CLI, –¥–æ–±–∞–≤—å –≤ —Ñ–∞–π–ª /etc/sudoers.d/hq-group:
%hq ALL=(ALL) NOPASSWD: /bin/cat, /bin/grep, /usr/bin/id
________________________________________
üîß 5. –í–≤–æ–¥ HQ-CLI –≤ –¥–æ–º–µ–Ω:
–ù–∞ HQ-CLI:
sudo apt install realmd sssd adcli samba-common krb5-user packagekit -y
sudo realm join --user=Administrator AU-TEAM.IRPO
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
realm list
id user1.hq@AU-TEAM.IRPO
________________________________________
üîß 6. –ò–º–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ñ–∞–π–ª–∞:
–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª /opt/users.csv —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –¢–æ–≥–¥–∞:
while IFS=',' read -r username password; do
  sudo samba-tool user create "$username" "$password"
  sudo samba-tool group addmembers hq "$username"
done < /opt/users.csv
–®–∞–≥ 2. HQ-SRV ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RAID5 –∏ —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —á–µ—Ä–µ–∑ NFS
________________________________________
üìç –ó–∞–¥–∞—á–∞:
1.	–ò—Å–ø–æ–ª—å–∑—É—è 3 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∏—Å–∫–∞ –ø–æ 1 –ì–ë, —Å–æ–±—Ä–∞—Ç—å RAID5 (/dev/md0).
2.	–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ ext4, —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ /raid5, –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ fstab.
3.	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å NFS-—Å–µ—Ä–≤–µ—Ä –∏ —Ä–∞—Å—à–∞—Ä–∏—Ç—å –ø–∞–ø–∫—É /raid5/nfs –¥–ª—è HQ-CLI —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å.
4.	–ù–∞ HQ-CLI –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ /mnt/nfs.
________________________________________
‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–Ω–∞ HQ-SRV):
–£—Å—Ç–∞–Ω–æ–≤–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã:
sudo apt update
sudo apt install mdadm nfs-kernel-server -y
________________________________________
üîß 1. –°–æ–∑–¥–∞–Ω–∏–µ RAID5 –∏–∑ 3 –¥–∏—Å–∫–æ–≤
–î–æ–ø—É—Å—Ç–∏–º, –¥–∏—Å–∫–∏ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è /dev/sdb, /dev/sdc, /dev/sdd. –ü—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑:
lsblk
–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞:

sudo mdadm --create --verbose /dev/md0 --level=5 --raid-devices=3 /dev/sdb /dev/sdc /dev/sdd
–ü—Ä–æ–≤–µ—Ä–∫–∞:
cat /proc/mdstat
________________________________________
üîß 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–∞:
–°–æ–∑–¥–∞–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª:
sudo mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf
sudo update-initramfs -u
–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
sudo mkfs.ext4 /dev/md0
sudo mkdir -p /raid5/nfs
________________________________________
üîß 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (fstab):
–î–æ–±–∞–≤—å –≤ /etc/fstab —Å—Ç—Ä–æ–∫—É:
/dev/md0  /raid5  ext4  defaults  0  0
–ü—Ä–∏–º–µ–Ω–∏—Ç—å:
sudo mount -a
________________________________________
üîß 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NFS-—Å–µ—Ä–≤–µ—Ä–∞:
–û—Ç–∫—Ä–æ–π /etc/exports:
sudo nano /etc/exports
–î–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É:
/raid5/nfs  172.16.100.0/24(rw,sync,no_subtree_check)
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:
sudo systemctl restart nfs-server
–ü—Ä–æ–≤–µ—Ä—å —ç–∫—Å–ø–æ—Ä—Ç:
sudo exportfs -v
________________________________________
‚úÖ HQ-SRV –≥–æ—Ç–æ–≤. –¢–µ–ø–µ—Ä—å –Ω–∞ HQ-CLI:
–£—Å—Ç–∞–Ω–æ–≤–∏ –∫–ª–∏–µ–Ω—Ç:
sudo apt install nfs-common -y
–°–æ–∑–¥–∞–π —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
sudo mkdir -p /mnt/nfs
–î–æ–±–∞–≤—å –≤ /etc/fstab:
hq-srv.au-team.irpo:/raid5/nfs  /mnt/nfs  nfs  defaults  0  0
–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
sudo mount -a
–ü—Ä–æ–≤–µ—Ä–∫–∞:
df -h | grep nfs
–®–∞–≥ 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É–∂–±—ã —Å–µ—Ç–µ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (NTP) –Ω–∞ –±–∞–∑–µ Chrony
________________________________________
üìç –ó–∞–¥–∞—á–∞:
1.	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å HQ-RTR –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä chrony, stratum 5.
2.	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤:
o	HQ-SRV
o	HQ-CLI
o	BR-RTR
o	BR-SRV
________________________________________
‚úÖ –ù–∞ HQ-RTR ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Chrony:
1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
sudo apt update
sudo apt install chrony -y
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ /etc/chrony/chrony.conf:
–û—Ç–∫—Ä–æ–π –∏ –≤–Ω–µ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
sudo nano /etc/chrony/chrony.conf
üîÅ –£–¥–∞–ª–∏ –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —Å—Ç—Ä–æ–∫–∏ —Å pool –∏ –¥–æ–±–∞–≤—å:
local stratum 5
allow 172.16.0.0/16
allow 192.168.100.0/24
allow 10.10.10.0/30
–î–æ–±–∞–≤—å –ª–æ–≥:
log tracking measurements statistics
–°–æ—Ö—Ä–∞–Ω–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏:
sudo systemctl restart chrony
sudo systemctl enable chrony
–ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å:
chronyc tracking
________________________________________
‚úÖ –ù–∞ –∫–ª–∏–µ–Ω—Ç–∞—Ö: HQ-SRV, HQ-CLI, BR-RTR, BR-SRV
1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
bash
sudo apt install chrony -y
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ /etc/chrony/chrony.conf:
–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –Ω–∞:
server hq-rtr.au-team.irpo iburst
–£–¥–∞–ª–∏—Ç—å –≤—Å–µ pool ... –∏–ª–∏ server ... —Å—Ç—Ä–æ–∫–∏, –∫—Ä–æ–º–µ —ç—Ç–æ–π.
–°–æ—Ö—Ä–∞–Ω–∏, –∑–∞—Ç–µ–º:
sudo systemctl restart chrony
sudo systemctl enable chrony
3. –ü—Ä–æ–≤–µ—Ä–∫–∞:
chronyc sources
chronyc tracking
–ï—Å–ª–∏ —Ç—ã –≤–∏–¥–∏—à—å * –ø–µ—Ä–µ–¥ –∏–º–µ–Ω–µ–º hq-rtr.au-team.irpo ‚Äî –≤—Å—ë —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
________________________________________
‚úÖ –®–∞–≥ 3 –∑–∞–≤–µ—Ä—à—ë–Ω. –í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç –≤—Ä–µ–º—è —Å HQ-RTR.
–®–∞–≥ 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ansible –Ω–∞ BR-SRV
________________________________________
üìç –ó–∞–¥–∞—á–∞:
1.	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ansible.
2.	–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å —Ö–æ—Å—Ç–∞–º–∏:
o	HQ-SRV
o	HQ-CLI
o	HQ-RTR
o	BR-RTR
3.	–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã –æ—Ç BR-SRV –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ (ping ‚Üí pong).
4.	–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è ‚Äî /etc/ansible.
________________________________________
‚úÖ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ansible:
sudo apt update
sudo apt install ansible -y
________________________________________
‚úÖ 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
–°–æ–∑–¥–∞–π –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π /etc/ansible/hosts:
 [office]
hq-srv.au-team.irpo
hq-cli.au-team.irpo
hq-rtr.au-team.irpo
br-rtr.au-team.irpo
–ü—Ä–æ–≤–µ—Ä—å:
cat /etc/ansible/hosts
________________________________________
‚úÖ 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH-–¥–æ—Å—Ç—É–ø–∞ –ø–æ –∫–ª—é—á–∞–º
–û—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è sshuser –Ω–∞ BR-SRV:
ssh-keygen -t rsa
ssh-copy-id sshuser@hq-srv.au-team.irpo
ssh-copy-id sshuser@hq-cli.au-team.irpo
ssh-copy-id sshuser@hq-rtr.au-team.irpo
ssh-copy-id sshuser@br-rtr.au-team.irpo
–ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
ssh sshuser@hq-srv.au-team.irpo hostname
________________________________________
‚úÖ 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Ansible-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
–°–æ–∑–¥–∞–π —Ñ–∞–π–ª /etc/ansible/ansible.cfg (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç), –¥–æ–±–∞–≤—å:
 [defaults]
inventory = /etc/ansible/hosts
remote_user = sshuser
host_key_checking = False
–¢–µ–ø–µ—Ä—å —Ç–µ—Å—Ç:
ansible office -m ping
–£—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
hq-srv.au-team.irpo | SUCCESS => {"ping": "pong"}
hq-cli.au-team.irpo | SUCCESS => {"ping": "pong"}
...
________________________________________
‚úÖ Ansible –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ –æ—à–∏–±–æ–∫, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω.
–®–∞–≥ 5. –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ MediaWiki –≤ Docker –Ω–∞ BR-SRV
________________________________________
üìç –ó–∞–¥–∞—á–∞:
1.	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Docker + Docker Compose.
2.	–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª wiki.yml –≤ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ sshuser.
3.	–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å:
o	–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä wiki (–æ–±—Ä–∞–∑ mediawiki);
o	–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä mariadb (–æ–±—Ä–∞–∑ mariadb);
o	–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LocalSettings.php, –∫–æ—Ç–æ—Ä—ã–π –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
4.	–û—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø –∫ MediaWiki –ø–æ –ø–æ—Ä—Ç—É 8080.
________________________________________
‚úÖ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose:
sudo apt update
sudo apt install docker.io docker-compose -y
sudo systemctl enable docker --now
sudo usermod -aG docker sshuser
‚ö†Ô∏è –ü–µ—Ä–µ–∑–∞–π–¥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è sshuser, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å.
________________________________________
‚úÖ 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
–ü–µ—Ä–µ–π–¥–∏ –≤ –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è sshuser:
cd ~
mkdir mediawiki && cd mediawiki
touch wiki.yml
–°–æ–∑–¥–∞–π —Ç–∞–∫–∂–µ –ø—É—Å—Ç–æ–π –∫–æ–Ω—Ñ–∏–≥-—Ñ–∞–π–ª:
touch LocalSettings.php
________________________________________
‚úÖ 3. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ wiki.yml:
–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª wiki.yml:
yaml
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
version: '3.3'

services:
  mariadb:
    image: mariadb
    container_name: mariadb
    restart: always
    environment:
      MYSQL_DATABASE: mediawiki
      MYSQL_USER: wiki
      MYSQL_PASSWORD: WikiP@ssw0rd
      MYSQL_ROOT_PASSWORD: root
    volumes:
      - mariadb_data:/var/lib/mysql

  wiki:
    image: mediawiki
    container_name: wiki
    restart: always
    ports:
      - "8080:80"
    environment:
      MEDIAWIKI_DB_HOST: mariadb
      MEDIAWIKI_DB_USER: wiki
      MEDIAWIKI_DB_PASSWORD: WikiP@ssw0rd
      MEDIAWIKI_DB_NAME: mediawiki
    volumes:
      - ./LocalSettings.php:/var/www/html/LocalSettings.php

volumes:
  mariadb_data:
–°–æ—Ö—Ä–∞–Ω–∏ —Ñ–∞–π–ª.
________________________________________
‚úÖ 4. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
–ò–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è wiki.yml:

docker compose -f wiki.yml up -d
–ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É:
docker ps
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã wiki –∏ mariadb –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ UP.
________________________________________
‚úÖ 5. –ü—Ä–æ–≤–µ—Ä–∫–∞:
–û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ HQ-CLI –∏–ª–∏ –ø–æ IP-–∞–¥—Ä–µ—Å—É BR-SRV:
http://br-srv.au-team.irpo:8080
–¢—ã –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ MediaWiki. –ü—Ä–æ–π–¥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π LocalSettings.php, –∑–∞–º–µ–Ω–∏ –∏–º —Ç–µ–∫—É—â–∏–π –≤ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
‚úÖ MediaWiki —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –ø–æ—Ä—Ç—É 8080.
–®–∞–≥ 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–æ–≤ (Port Forwarding / DNAT)
________________________________________
üìç –ó–∞–¥–∞—á–∞:
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é –ø–æ—Ä—Ç–æ–≤ (DNAT) –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞—Ö:
üî∏ HQ-RTR:
‚Ä¢	–ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ 2024 ‚Üí –Ω–∞ HQ-SRV:2024
üî∏ BR-RTR:
‚Ä¢	–ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ 2024 ‚Üí –Ω–∞ BR-SRV:2024
‚Ä¢	–ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ 80 ‚Üí –Ω–∞ BR-SRV:8080 (–¥–ª—è wiki)
________________________________________
–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ NAT —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ HQ-RTR –∏ BR-RTR (–∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –æ—Ç—á—ë—Ç–µ –ø–æ –º–æ–¥—É–ª—é 1). –†–∞–±–æ—Ç–∞–µ–º —Å iptables.
________________________________________
‚úÖ –ù–∞ HQ-RTR:
–ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ 2024:
sudo iptables -t nat -A PREROUTING -i enp0s3 -p tcp --dport 2024 -j DNAT --to-destination 172.16.100.2:2024
sudo iptables -A FORWARD -p tcp -d 172.16.100.2 --dport 2024 -j ACCEPT
________________________________________
‚úÖ –ù–∞ BR-RTR:
–ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ 2024:
sudo iptables -t nat -A PREROUTING -i enp0s3 -p tcp --dport 2024 -j DNAT --to-destination 192.168.100.2:2024
sudo iptables -A FORWARD -p tcp -d 192.168.100.2 --dport 2024 -j ACCEPT
–ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ 80 (–Ω–∞—Ä—É–∂—É) –Ω–∞ MediaWiki (–ø–æ—Ä—Ç 8080 –Ω–∞ BR-SRV):
sudo iptables -t nat -A PREROUTING -i enp0s3 -p tcp --dport 80 -j DNAT --to-destination 192.168.100.2:8080
sudo iptables -A FORWARD -p tcp -d 192.168.100.2 --dport 8080 -j ACCEPT
________________________________________
üíæ –ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:
Ubuntu:
sudo apt install iptables-persistent
sudo netfilter-persistent save
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–µ—Å–ª–∏ –±–µ–∑ iptables-persistent):
–î–æ–±–∞–≤—å –ø—Ä–∞–≤–∏–ª–∞ –≤ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä /etc/rc.local.
________________________________________
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞:
‚Ä¢	–ò–∑ –≤–Ω–µ—à–Ω–µ–π —Å–µ—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—Ä—Ç—É 2024 HQ-RTR ‚Äî –ø–æ–ø–∞–¥–∞–µ—à—å –Ω–∞ SSH HQ-SRV.
‚Ä¢	–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—Ä—Ç—É 80 BR-RTR ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è MediaWiki (–ø–æ—Ä—Ç 8080 –Ω–∞ BR-SRV).
________________________________________
‚úÖ –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.
–®–∞–≥ 7. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Moodle –Ω–∞ HQ-SRV
________________________________________
üìç –ó–∞–¥–∞—á–∞:
1.	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Apache, MariaDB, PHP –∏ –º–æ–¥—É–ª–∏.
2.	–°–æ–∑–¥–∞—Ç—å –ë–î moodledb, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è moodle —Å –ø–∞—Ä–æ–ª–µ–º P@ssw0rd.
3.	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Moodle –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –≤–µ–±.
4.	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å P@ssw0rd –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Moodle.
5.	–ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ Moodle –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–æ–º–µ—Ä —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞ (–∞—Ä–∞–±—Å–∫–æ–π —Ü–∏—Ñ—Ä–æ–π).
________________________________________
‚úÖ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Apache, MariaDB –∏ PHP:
sudo apt update
sudo apt install apache2 mariadb-server -y
sudo systemctl enable apache2 --now
sudo systemctl enable mariadb --now
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PHP –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π:
sudo apt install php php-mysql php-curl php-gd php-intl php-xml php-mbstring php-zip php-soap php-bcmath php-cli unzip -y
________________________________________
‚úÖ 2. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Moodle:
–í—Ö–æ–¥ –≤ MySQL:
sudo mysql
SQL-–∫–æ–º–∞–Ω–¥—ã:
CREATE DATABASE moodledb DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'moodle'@'localhost' IDENTIFIED BY 'P@ssw0rd';
GRANT ALL PRIVILEGES ON moodledb.* TO 'moodle'@'localhost';
FLUSH PRIVILEGES;
EXIT;
________________________________________
‚úÖ 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Moodle:
–ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞:
cd /var/www/html
sudo wget https://download.moodle.org/download.php/direct/stable401/moodle-latest-401.tgz
sudo tar -xvzf moodle-latest-401.tgz
sudo mv moodle /var/www/html/moodle
sudo mkdir /var/moodledata
sudo chown -R www-data:www-data /var/www/html/moodle /var/moodledata
sudo chmod -R 755 /var/www/html/moodle /var/moodledata
________________________________________
‚úÖ 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Apache:
–°–æ–∑–¥–∞–π –∫–æ–Ω—Ñ–∏–≥ /etc/apache2/sites-available/moodle.conf:
<VirtualHost *:80>
    DocumentRoot /var/www/html/moodle
    ServerName hq-srv.au-team.irpo

    <Directory /var/www/html/moodle>
        AllowOverride All
    </Directory>
</VirtualHost>
–ê–∫—Ç–∏–≤–∞—Ü–∏—è:
sudo a2ensite moodle.conf
sudo a2enmod rewrite
sudo systemctl reload apache2
________________________________________
‚úÖ 5. –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Moodle:
–û—Ç–∫—Ä–æ–π –Ω–∞ HQ-CLI –±—Ä–∞—É–∑–µ—Ä:
http://hq-srv.au-team.irpo
–ü—Ä–æ–π–¥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫—É:
‚Ä¢	–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: moodledb
‚Ä¢	–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: moodle
‚Ä¢	–ü–∞—Ä–æ–ª—å: P@ssw0rd
‚Ä¢	–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è moodledata: /var/moodledata
‚Ä¢	–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: admin, –ø–∞—Ä–æ–ª—å: P@ssw0rd
________________________________________
‚úÖ 6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞:
–û—Ç–∫—Ä–æ–π –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞–∫ admin, –ø–µ—Ä–µ–π–¥–∏ –≤:
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞ ‚Üí –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚Üí –í –ø–æ–ª–µ ¬´–û–ø–∏—Å–∞–Ω–∏–µ¬ª –∏–ª–∏ ¬´–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞¬ª –≤–ø–∏—à–∏ –Ω–æ–º–µ—Ä —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
–†–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ 5
–®–∞–≥ 8. HQ-RTR ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx –∫–∞–∫ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏
________________________________________
üìç –ó–∞–¥–∞—á–∞:
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ HQ-RTR –≤–µ–±-—Å–µ—Ä–≤–µ—Ä nginx, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç:
‚Ä¢	–ø–æ –∏–º–µ–Ω–∏ moodle.au-team.irpo –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ HQ-SRV:80
‚Ä¢	–ø–æ –∏–º–µ–Ω–∏ wiki.au-team.irpo –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ BR-SRV:8080
________________________________________
‚úÖ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nginx:
sudo apt update
sudo apt install nginx -y
sudo systemctl enable nginx --now
________________________________________
‚úÖ 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx:
–°–æ–∑–¥–∞–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª:
sudo nano /etc/nginx/sites-available/reverse
–í—Å—Ç–∞–≤—å —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:
server {
    listen 80;
    server_name moodle.au-team.irpo;

    location / {
        proxy_pass http://hq-srv.au-team.irpo;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

server {
    listen 80;
    server_name wiki.au-team.irpo;

    location / {
        proxy_pass http://br-srv.au-team.irpo:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
–°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞:
sudo ln -s /etc/nginx/sites-available/reverse /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:
sudo nginx -t
sudo systemctl restart nginx
________________________________________
‚úÖ 3. –ü—Ä–æ–≤–µ—Ä–∫–∞:
–ù–∞ HQ-CLI –∏–ª–∏ –ª—é–±–æ–º –∫–ª–∏–µ–Ω—Ç–µ —Å DNS-–∑–∞–ø–∏—Å—å—é:
‚Ä¢	http://moodle.au-team.irpo ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Moodle —Å HQ-SRV
‚Ä¢	http://wiki.au-team.irpo ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è MediaWiki —Å BR-SRV:8080
–ï—Å–ª–∏ DNS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ /etc/hosts HQ-CLI:
<IP_HQ-RTR> moodle.au-team.irpo wiki.au-team.irpo
________________________________________
‚úÖ –û–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.
–®–∞–≥ 9. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä–∞ (–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ) –Ω–∞ HQ-CLI
________________________________________
üìç –ó–∞–¥–∞—á–∞:
‚Ä¢	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –Ω–∞ HQ-CLI.
‚Ä¢	–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –≤ –æ—Ç—á—ë—Ç–µ.
________________________________________
‚úÖ 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Yandex Browser:
–ù–∞ HQ-CLI:
wget https://browser.yandex.ru/download/?os=linux -O yandex-browser.rpm
–¢–∞–∫ –∫–∞–∫ Alt Linux –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç RPM, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é:
sudo rpm -i yandex-browser.rpm
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
sudo apt install alien -y
sudo alien -i yandex-browser.rpm
________________________________________
‚úÖ 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞:
–ó–∞–ø—É—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä –∏–∑ –º–µ–Ω—é –∏–ª–∏:
yandex-browser
–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–º–ø–æ—Ä—Ç –∏–∑ –¥—Ä—É–≥–∏—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ ‚Äî —ç—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å.
________________________________________
‚úÖ 3. –û—Ç–º–µ—Ç–∫–∞ –≤ –æ—Ç—á—ë—Ç–µ:
–í –∏—Ç–æ–≥–æ–≤–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ —É–∫–∞–∂–∏:
–ù–∞ HQ-CLI —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä (–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è). –ü—Ä–æ–≤–µ—Ä–µ–Ω –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
________________________________________
‚úÖ –ó–∞–¥–∞–Ω–∏—è 2 –º–æ–¥—É–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!
–û—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è ‚Äî –ú–æ–¥—É–ª—å 2 (–ö–û–î 09.02.06-1-2025)
1. –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è HQ-CLI –∫ –¥–æ–º–µ–Ω—É Samba
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: –ù–µ —É–¥–∞—ë—Ç—Å—è –≤–æ–π—Ç–∏ –≤ –¥–æ–º–µ–Ω / –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
1.	–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ Samba –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–æ–º–µ–Ω–∞: sudo samba-tool domain info localhost
2.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (–∏—Å–ø–æ–ª—å–∑—É–π chrony).
3.	–ü—Ä–æ–≤–µ—Ä—å DNS: ping br-srv.au-team.irpo –∏ nslookup _ldap._tcp.dc._msdcs.au-team.irpo
4.	–í HQ-CLI —É–∫–∞–∂–∏ DNS-—Å–µ—Ä–≤–µ—Ä –∫–∞–∫ IP BR-SRV –≤ Netplan –∏–ª–∏ –≤—Ä—É—á–Ω—É—é –≤ /etc/resolv.conf
5.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ hostname HQ-CLI —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–º–µ–Ω–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º–æ–≥–æ –≤ –¥–æ–º–µ–Ω–µ.
2. –û—à–∏–±–∫–∞ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ–±—â–µ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ (NFS)
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: –ü–∞–ø–∫–∞ /mnt/nfs –Ω–µ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
6.	–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä NFS (HQ-SRV) —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ /raid5/nfs.
7.	–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ /etc/exports —É–∫–∞–∑–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–µ—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 172.16.100.0/24).
8.	–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: sudo exportfs -ra && sudo systemctl restart nfs-server
9.	–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (HQ-CLI): sudo mount -a –∏ —É–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—É—Ç—å –ø—Ä–æ–ø–∏—Å–∞–Ω –≤ /etc/fstab.
3. –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–ª—É–∂–±—ã –≤—Ä–µ–º–µ–Ω–∏ chrony
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: –°–ª—É–∂–±—ã –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è, —á–∞—Å—ã –æ—Ç–ª–∏—á–∞—é—Ç—Å—è
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
10.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ HQ-RTR –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ chrony.
11.	–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä HQ-CLI): –ø—Ä–æ–≤–µ—Ä—å /etc/chrony/chrony.conf ‚Äî —Ç–∞–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å server HQ-RTR iburst
12.	–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ chronyd: sudo systemctl restart chrony
13.	–ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å: chronyc tracking –∏ chronyc sources
4. Ansible –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Ü–µ–ª–µ–≤—ã–º –º–∞—à–∏–Ω–∞–º
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: ansible ping –≤—ã–¥–∞—ë—Ç UNREACHABLE –∏–ª–∏ Permission denied
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
14.	–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è sshuser –µ—Å—Ç—å SSH-–¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ü–µ–ª–µ–≤—ã–º –º–∞—à–∏–Ω–∞–º.
15.	–í—ã–ø–æ–ª–Ω–∏ ssh-copy-id sshuser@<host> –¥–ª—è –∫–∞–∂–¥–æ–π —Ü–µ–ª–∏ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è.
16.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª /etc/ansible/hosts —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ IP/–∏–º–µ–Ω–∞ –º–∞—à–∏–Ω.
17.	–ü—Ä–æ–≤–µ—Ä—å ansible.cfg –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è sudo.
5. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä MediaWiki –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: docker-compose –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–ª–∏ wiki –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
18.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ docker –∏ docker-compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –∞–∫—Ç–∏–≤–Ω—ã.
19.	–ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞ wiki.yml: –æ–±—Ä–∞–∑—ã, —Ç–æ–º–∞, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
20.	–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: docker logs <–∏–º—è_–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞>
21.	–ü—Ä–æ–≤–µ—Ä—å –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—é –ø–æ—Ä—Ç–∞ 8080.
6. Moodle –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ HQ-SRV
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–∞–π—Ç—É –∏–ª–∏ –æ—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
22.	–ü—Ä–æ–≤–µ—Ä—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ Apache: sudo systemctl status apache2
23.	–ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: –∏–º—è –ë–î moodledb, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å moodle, –ø–∞—Ä–æ–ª—å P@ssw0rd
24.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ mariadb —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ moodledb —Å–æ–∑–¥–∞–Ω–∞.
25.	–ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Moodle –≤ config.php, –æ—Å–æ–±–µ–Ω–Ω–æ DB host –∏ user.
7. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–±—Ä–æ—Å–æ–º –ø–æ—Ä—Ç–æ–≤ –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–µ
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: –ü—Ä–æ–±—Ä–æ—Å 2024, 8080 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (NAT DNAT)
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
26.	–ü—Ä–æ–≤–µ—Ä—å iptables DNAT-–ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ HQ-RTR –∏ BR-RTR: sudo iptables -t nat -L -n -v
27.	–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª–∞ DNAT: sudo iptables -t nat -A PREROUTING -i enp0s3 -p tcp --dport 8080 -j DNAT --to-destination 192.168.100.2:8080
28.	–ü—Ä–æ–≤–µ—Ä—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Å–ª—É–∂–±–∞ –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º —Å–µ—Ä–≤–µ—Ä–µ.


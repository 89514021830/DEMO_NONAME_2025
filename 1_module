ISP
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 1: NAT (–¥–ª—è –≤—ã—Ö–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 2: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å ‚Äî ISP-HQ
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 3: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å ‚Äî ISP-BR
________________________________________
HQ-RTR
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 1: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å ‚Äî ISP-HQ
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 2: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å ‚Äî HQ-LAN
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 3: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å ‚Äî HQ-MGMT
________________________________________
BR-RTR
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 1: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å ‚Äî ISP-BR
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 2: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å ‚Äî BR-LAN
________________________________________
HQ-SRV
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 1: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å ‚Äî HQ-LAN
________________________________________
HQ-CLI
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 1: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å ‚Äî HQ-LAN
________________________________________
BR-SRV
‚Ä¢	–ê–¥–∞–ø—Ç–µ—Ä 1: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å ‚Äî BR-LAN
________________________________________
–í—Å–µ —Å–µ—Ç–∏ (HQ-LAN, ISP-HQ, –∏ —Ç.–¥.) –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å –ø–æ –∏–º–µ–Ω–∏ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –∏–Ω–∞—á–µ –Ω–µ –±—É–¥–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.
–ù–ê–°–¢–†–û–ô–ö–ê ISP
1. –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
–ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –∏–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É:
sudo hostnamectl set-hostname isp.au-team.irpo
–î–æ–±–∞–≤–∏–º –≤ /etc/hosts:
127.0.0.1 localhost
127.0.1.1 isp.au-team.irpo isp
________________________________________
 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ IP-–∞–¥—Ä–µ—Å–æ–≤
–ü–æ –∑–∞–¥–∞–Ω–∏—é, –Ω–∞ ISP –¥–≤–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
‚Ä¢	–æ–¥–∏–Ω –≤ —Å—Ç–æ—Ä–æ–Ω—É HQ-RTR: —Å–µ—Ç—å 172.16.4.0/28
‚Ä¢	–æ–¥–∏–Ω –≤ —Å—Ç–æ—Ä–æ–Ω—É BR-RTR: —Å–µ—Ç—å 172.16.5.0/28
‚Ä¢	—Ç—Ä–µ—Ç–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî –≤ —Å—Ç–æ—Ä–æ–Ω—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (—á–µ—Ä–µ–∑ DHCP)
Netplan (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã enp0s3, enp0s8, enp0s9): sudo nano /etc/netplan/*.yaml
/etc/netplan/*.yaml

network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:  # –í —Å—Ç–æ—Ä–æ–Ω—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
      dhcp4: true
    enp0s8:  # –í —Å—Ç–æ—Ä–æ–Ω—É HQ-RTR
      addresses:
        - 172.16.4.1/28
    enp0s9:  # –í —Å—Ç–æ—Ä–æ–Ω—É BR-RTR
      addresses:
        - 172.16.5.1/28
–ü—Ä–∏–º–µ–Ω–∏–º:
sudo netplan apply
________________________________________
3. –í–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
–û—Ç–∫—Ä–æ–µ–º —Ñ–∞–π–ª:
sudo nano /etc/sysctl.conf
–£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞:
net.ipv4.ip_forward=1
–ü—Ä–∏–º–µ–Ω–∏–º:
sudo sysctl -p
________________________________________
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è)
–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–º–æ—Ç—Ä–∏—Ç enp0s3:
sudo iptables -t nat -A POSTROUTING -o enp0s3 -j MASQUERADE
–£—Å—Ç–∞–Ω–æ–≤–∏–º –∏ —Å–æ—Ö—Ä–∞–Ω–∏–º –ø—Ä–∞–≤–∏–ª–∞:
sudo apt install iptables-persistent
sudo netfilter-persistent save
________________________________________
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–ü—Ä–æ–≤–µ—Ä–∏–º —Å–≤—è–∑—å —Å HQ-RTR –∏ BR-RTR:
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
ping 172.16.4.2   # HQ-RTR
ping 172.16.5.2   # BR-RTR
6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OSPF 
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º FRR –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –¥–µ–º–æ–Ω—ã OSPF:
sudo apt update && sudo apt install frr -y
sudo nano /etc/frr/daemons
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
ospfd=yes

sudo systemctl restart frr
–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ OSPF —á–µ—Ä–µ–∑ vtysh:
sudo vtysh

configure terminal
router-id 1.1.1.1
router ospf
network 172.16.4.0/28 area 0
network 172.16.5.0/28 area 0
exit
write

HQ-RTR ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—à–∞–≥–æ–≤–æ
1. –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
sudo hostnamectl set-hostname hq-rtr.au-team.irpo
–í —Ñ–∞–π–ª /etc/hosts –¥–æ–±–∞–≤–∏–º:
127.0.1.1 hq-rtr.au-team.irpo hq-rtr
________________________________________
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ IP-–∞–¥—Ä–µ—Å–æ–≤
–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç—Ä–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
‚Ä¢	enp0s3 ‚Äì –≤ —Å—Ç–æ—Ä–æ–Ω—É ISP: 172.16.4.2/28
‚Ä¢	enp0s8 ‚Äì –≤ —Å—Ç–æ—Ä–æ–Ω—É –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ HQ:
o	VLAN 100 ‚Äì HQ-SRV (–¥–æ 64 –∞–¥—Ä–µ—Å–æ–≤) ‚Üí 172.16.100.0/26
o	VLAN 200 ‚Äì HQ-CLI (–¥–æ 16 –∞–¥—Ä–µ—Å–æ–≤) ‚Üí 172.16.100.64/28
o	VLAN 999 ‚Äì —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–¥–æ 8 –∞–¥—Ä–µ—Å–æ–≤) ‚Üí 172.16.100.80/29
Sudo nano /etc/netplan/*.yaml

network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      addresses: [172.16.4.2/28]  # ISP
    enp0s8: {}  # –ë–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ IP
  vlans:
    enp0s8.100:
      id: 100
      link: enp0s8
      addresses: [172.16.100.1/26]
    enp0s8.200:
      id: 200
      link: enp0s8
      addresses: [172.16.100.65/28]
    enp0s8.999:
      id: 999
      link: enp0s8
      addresses: [172.16.100.81/29]

–í–ï–†–ù–´–ô –í–ê–†–ò–ê–ù–¢
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      addresses: [172.16.4.2/28]
      routes:
        - to: 0.0.0.0/0
          via: 172.16.4.1
          on-link: true
      nameservers:
        addresses: [8.8.8.8]
    enp0s8: {}
  vlans:
    enp0s8.100:
      id: 100
      link: enp0s8
      addresses: [172.16.100.1/26]
    enp0s8.200:
      id: 200
      link: enp0s8
      addresses: [172.16.100.65/28]
    enp0s8.999:
      id: 999
      link: enp0s8
      addresses: [172.16.100.81/29]
–ü—Ä–∏–º–µ–Ω–∏–º:
sudo netplan apply
________________________________________
3. –í–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
sudo nano /etc/sysctl.conf
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
net.ipv4.ip_forward=1
–ü—Ä–∏–º–µ–Ω–∏–º:
sudo sysctl -p
________________________________________
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OSPF (—á–µ—Ä–µ–∑ FRR)
–£—Å—Ç–∞–Ω–æ–≤–∏–º FRR:
sudo apt install frr -y
–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –¥–µ–º–æ–Ω—ã:
sudo nano /etc/frr/daemons
# –í–∫–ª—é—á–∞–µ–º:
ospfd=yes
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º:
sudo systemctl restart frr
–ù–∞—Å—Ç—Ä–æ–∏–º —á–µ—Ä–µ–∑ vtysh:
sudo vtysh

configure terminal
router-id 1.1.1.2
router ospf
network 172.16.4.0/28 area 0
network 172.16.100.0/26 area 0
network 172.16.100.64/28 area 0
network 172.16.100.80/29 area 0
exit
write
________________________________________
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT
–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ HQ-RTR –±—É–¥–µ—Ç —Å–∞–º –≤—ã—Ö–æ–¥–∏—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–ø–æ –∑–∞–¥–∞–Ω–∏—é ‚Äî NAT –≤—ã–ø–æ–ª–Ω—è–µ—Ç ISP), —Ç–æ–≥–¥–∞ NAT –∑–¥–µ—Å—å –Ω–µ –Ω—É–∂–µ–Ω.
________________________________________
6. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è net_admin
sudo useradd -m net_admin
echo 'net_admin:P@$$word' | sudo chpasswd
sudo usermod -aG sudo net_admin

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ sudo –±–µ–∑ –ø–∞—Ä–æ–ª—è:
echo 'net_admin ALL=(ALL) NOPASSWD:ALL' | sudo tee /etc/sudoers.d/net_admin
________________________________________
7. DHCP –¥–ª—è HQ-CLI
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:
sudo apt install isc-dhcp-server
sudo nano /etc/dhcp/dhcpd.conf
–î–æ–±–∞–≤–∏–º:
option domain-name "au-team.irpo";
option domain-name-servers 172.16.100.2, 8.8.8.8;

subnet 172.16.100.64 netmask 255.255.255.240 {
  range 172.16.100.66 172.16.100.78;
  option routers 172.16.100.65;
}
–£–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ /etc/default/isc-dhcp-server:
INTERFACESv4="enp0s8.200"
–ó–∞–ø—É—Å–∫–∞–µ–º DHCP:
sudo systemctl restart isc-dhcp-server
sudo systemctl enable isc-dhcp-server
________________________________________
8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
‚Ä¢	HQ-CLI –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å IP –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ 172.16.100.66-78
‚Ä¢	HQ-SRV –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ 172.16.100.2
‚Ä¢	HQ-RTR –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å ISP –∏ HQ
–ï–°–õ–ò –ü–†–û–ü–ê–õ –ü–ò–ù–ì –ò –ò–ù–¢–ï–†–ù–ï–¢
–ü–ï–†–í–´–ú –î–ï–õ–û–ú –ü–†–û–í–ï–†–ò–¢–¨ –ò–ú–ï–ù–ê –°–ï–¢–ï–ô –í –°–ï–¢–ï–í–´–• –ê–î–ê–ü–¢–ï–†–ê–•
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å ip route,  –µ—Å–ª–∏ –Ω–µ—Ç default via. –ù–∞–¥–æ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–∏—Ç—å:
sudo ip route add default via 172.16.4.1 dev enp0s3

–ó–∞–π—Ç–∏ sudo nano /etc/resolv.conf

nameserver 8.8.8.8  –û–Ω –ø—Ä–æ–ø–∞–¥–∞–µ—Ç —á–∞—Å—Ç–æ –∏–∑ —Ñ–∞–π–ª–∞, –º–æ–∂–Ω–æ –∫–∞–∫-—Ç–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ, –Ω–æ —è –Ω–µ —Ä–∞–∑–±–∏—Ä–∞–ª—Å—è –≤ —ç—Ç–æ–º. –ü–æ—ç—Ç–æ–º—É –µ—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏–ª–∏ –ø–∏–Ω–≥–∞, –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –µ–≥–æ –µ—Å–ª–∏ —É–¥–∞–ª–∏–ª—Å—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ BR-RTR
1. –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –∏–º–µ–Ω–∏
sudo hostnamectl set-hostname br-rtr.au-team.irpo
–î–æ–±–∞–≤–∏–º –≤ /etc/hosts:
127.0.1.1 br-rtr.au-team.irpo br-rtr
________________________________________
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ IP-–∞–¥—Ä–µ—Å–æ–≤
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:
‚Ä¢	enp0s3 ‚Äî –≤ —Å—Ç–æ—Ä–æ–Ω—É ISP: 172.16.5.2/28
‚Ä¢	enp0s8 ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å BR:
o	–ü–æ–¥—Å–µ—Ç—å –¥–æ 32 –∞–¥—Ä–µ—Å–æ–≤: 192.168.100.0/27
/etc/netplan/*.yaml

network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      addresses: [172.16.5.2/28]
    enp0s8:
      addresses: [192.168.100.1/27]

–í–ï–†–ù–´–ô –í–ê–†–ò–ê–ù–¢
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      addresses: [172.16.5.2/28]
      routes:
        - to: 0.0.0.0/0
          via: 172.16.5.1
      nameservers:
        addresses: [8.8.8.8, 1.1.1.1]
    enp0s8:
      addresses: [192.168.100.1/27]]
–ü—Ä–∏–º–µ–Ω–∏–º:
sudo netplan apply
________________________________________
3. –í–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
sudo nano /etc/sysctl.conf
–ü—Ä–æ–≤–µ—Ä–∏–º –∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º:
ini
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
net.ipv4.ip_forward=1
–ü—Ä–∏–º–µ–Ω–∏–º:
sudo sysctl -p
________________________________________
 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OSPF (FRR)
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º:
sudo apt update && sudo apt install frr -y
sudo nano /etc/frr/daemons
# –í–∫–ª—é—á–∞–µ–º:
ospfd=yes

sudo systemctl restart frr
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ vtysh:
sudo vtysh

configure terminal
router-id 2.2.2.2
router ospf
network 172.16.5.0/28 area 0
network 192.168.100.0/27 area 0
exit
write
________________________________________
5. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è net_admin
sudo useradd -m net_admin
echo 'net_admin:P@$$word' | sudo chpasswd
sudo usermod -aG sudo net_admin

echo 'net_admin ALL=(ALL) NOPASSWD:ALL' | sudo tee /etc/sudoers.d/net_admin
________________________________________
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ —Å–≤—è–∑–∏
‚Ä¢	–ü—Ä–æ–≤–µ—Ä–∏–º –ø–∏–Ω–≥ –æ—Ç BR-RTR –¥–æ ISP: ping 172.16.5.1
‚Ä¢	–î–æ HQ —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª—å ‚Äî –ø–æ–∑–∂–µ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—É–Ω–Ω–µ–ª—è –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
________________________________________
–ü–æ–∫–∞ –±–µ–∑ NAT ‚Äî NAT –±—É–¥–µ—Ç –ø–æ–∑–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ —Å—Ç–æ—Ä–æ–Ω—É ISP, –∫–∞–∫ –≤ HQ.


–ï–°–õ–ò –ù–ï–¢ –ò–ù–¢–ï–†–ù–ï–¢–ê, –î–ï–ô–°–¢–í–ò–Ø –ê–ù–ê–õ–û–ì–ò–ß–ù–´ –° HQ-RTR
‚Ä¢	–ø—Ä–æ–≤–µ—Ä—å –º–∞—Ä—à—Ä—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ BR-RTR:
ip route
–û–∂–∏–¥–∞–µ–º–æ–µ:
default via 172.16.5.1 dev enp0s3
–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤—å:
sudo ip route add default via 172.16.5.1 dev enp0s3

–ó–∞–π—Ç–∏ sudo nano /etc/resolv.conf

nameserver 8.8.8.8  –û–Ω –ø—Ä–æ–ø–∞–¥–∞–µ—Ç —á–∞—Å—Ç–æ –∏–∑ —Ñ–∞–π–ª–∞, –º–æ–∂–Ω–æ –∫–∞–∫-—Ç–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ, –Ω–æ —è –Ω–µ —Ä–∞–∑–±–∏—Ä–∞–ª—Å—è –≤ —ç—Ç–æ–º. –ü–æ—ç—Ç–æ–º—É –µ—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏–ª–∏ –ø–∏–Ω–≥–∞, –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –µ–≥–æ –µ—Å–ª–∏ —É–¥–∞–ª–∏–ª—Å—è

–ü–†–û–í–ï–†–ò–¢–¨ –ò–ú–ï–ù–ê –°–ï–¢–ï–í–´–• –ê–î–ê–ü–¢–ï–†–û–í

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—É–Ω–Ω–µ–ª—è
–ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ IP-—Ç—É–Ω–Ω–µ–ª—è –º–µ–∂–¥—É HQ-RTR –∏ BR-RTR. –ü–æ –∑–∞–¥–∞–Ω–∏—é:
–ú–µ–∂–¥—É –æ—Ñ–∏—Å–∞–º–∏ HQ –∏ BR –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å IP-—Ç—É–Ω–Ω–µ–ª—å.
–ù–∞ –≤—ã–±–æ—Ä: GRE –∏–ª–∏ IP-in-IP. –ú—ã –≤—ã–±–µ—Ä–µ–º GRE, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –Ω–∞–∏–±–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª–µ–Ω.
________________________________________
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ GRE-—Ç—É–Ω–Ω–µ–ª—è –º–µ–∂–¥—É HQ-RTR –∏ BR-RTR
________________________________________
IP-–∞–¥—Ä–µ—Å–∞ –¥–ª—è —Ç—É–Ω–Ω–µ–ª—è (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ):
‚Ä¢	HQ-RTR: 10.10.10.1/30
‚Ä¢	BR-RTR: 10.10.10.2/30
________________________________________
 –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —É—Ç–∏–ª–∏—Ç
–ù–∞ –æ–±–æ–∏—Ö –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞—Ö:
sudo apt install iproute2 -y
________________________________________
 –®–∞–≥ 2: HQ-RTR (–Ω–∞—Å—Ç—Ä–æ–∏–º GRE-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
# –°–æ–∑–¥–∞–µ–º GRE-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
sudo ip tunnel add gre1 mode gre local 172.16.4.2 remote 172.16.5.2 ttl 255
sudo ip addr add 10.10.10.1/30 dev gre1
sudo ip link set gre1 up
________________________________________
 –®–∞–≥ 3: BR-RTR (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç–Ω—É—é —á–∞—Å—Ç—å)
sudo ip tunnel add gre1 mode gre local 172.16.5.2 remote 172.16.4.2 ttl 255
sudo ip addr add 10.10.10.2/30 dev gre1
sudo ip link set gre1 up
________________________________________
 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—É–Ω–Ω–µ–ª—è
–ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Ç—É–Ω–Ω–µ–ª—å:
‚Ä¢	–° HQ-RTR:
ping 10.10.10.2
‚Ä¢	–° BR-RTR:
ping 10.10.10.1
________________________________________
–®–∞–≥ 4: –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç—ã —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª—å (–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—Ä—É—á–Ω—É—é)
–ù–∞ HQ-RTR:
sudo ip route add 192.168.100.0/27 via 10.10.10.2 dev gre1
–ù–∞ BR-RTR:
sudo ip route add 172.16.100.0/24 via 10.10.10.1 dev gre1
(–ü–æ–∑–∂–µ —ç—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—Å—è –Ω–∞ –º–∞—Ä—à—Ä—É—Ç—ã —á–µ—Ä–µ–∑ OSPF –ø–æ GRE-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.)
________________________________________
–®–∞–≥ 5: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–ß—Ç–æ–±—ã —Ç—É–Ω–Ω–µ–ª—å —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ, –¥–æ–±–∞–≤–∏–º –≤ /etc/network/interfaces –∏–ª–∏ –Ω–∞–ø–∏—à–µ–º —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞.
–ü—Ä–∏–º–µ—Ä (–Ω–∞ HQ-RTR):
sudo nano /etc/network/if-up.d/gre-up

#!/bin/bash
ip tunnel add gre1 mode gre local 172.16.4.2 remote 172.16.5.2 ttl 255
ip addr add 10.10.10.1/30 dev gre1
ip link set gre1 up
–°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –¥–µ–ª–∞–µ–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
sudo chmod +x /etc/network/if-up.d/gre-up

–¢–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–∏–º OSPF –ø–æ–≤–µ—Ä—Ö GRE-—Ç—É–Ω–Ω–µ–ª—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–º–µ–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ –º–µ–∂–¥—É HQ-RTR –∏ BR-RTR.

–¶–µ–ª—å:
‚Ä¢	OSPF –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ GRE
‚Ä¢	–ó–∞—â–∏—â–∞–µ–º OSPF –ø–∞—Ä–æ–ª–µ–º (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
‚Ä¢	HQ –∏ BR –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å —Å–µ—Ç–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞ —á–µ—Ä–µ–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é
________________________________________
 –°–µ—Ç—å —Ç—É–Ω–Ω–µ–ª—è:
‚Ä¢	GRE-—Å–µ—Ç—å: 10.10.10.0/30
________________________________________
 –®–∞–≥ 1: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ ospfd –∞–∫—Ç–∏–≤–µ–Ω
–ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞ –æ–±–æ–∏—Ö:
sudo nano /etc/frr/daemons
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
ospfd=yes
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:
sudo systemctl restart frr
–®–∞–≥ 2: HQ-RTR ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ OSPF —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

sudo vtysh

configure terminal

router ospf
 router-id 1.1.1.2
 passive-interface default
 network 10.10.10.0/30 area 0
exit

interface gre1
 no ip ospf passive
 ip ospf authentication message-digest
 ip ospf message-digest-key 1 md5 MySecurePass
exit

write
‚Ä¢  –ï—Å–ª–∏ –ø–æ—è–≤–∏–ª–æ—Å—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ router-id 1.1.1.2, –≤—ã–π–¥–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ –æ–±—ã—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (—á—Ç–æ–±—ã –±—ã–ª–æ –ø—Ä–æ—Å—Ç–æ hq-rtr#):
exit
‚Ä¢  –í—ã–ø–æ–ª–Ω–∏ –∏–º–µ–Ω–Ω–æ –æ—Ç—Ç—É–¥–∞:
clear ip ospf process
‚Ä¢  
–ï—Å–ª–∏ –æ–ø—è—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–π —Å—Ç—Ä–æ–∫—É
________________________________________
–®–∞–≥ 3: BR-RTR ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ OSPF —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
sudo vtysh

configure terminal

router ospf
 router-id 2.2.2.2
 passive-interface default
 network 10.10.10.0/30 area 0
exit

interface gre1
 no ip ospf passive
 ip ospf authentication message-digest
 ip ospf message-digest-key 1 md5 MySecurePass
exit

write
________________________________________
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
–ù–∞ –æ–±–æ–∏—Ö –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞—Ö:
show ip ospf neighbor

–¢—ã –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å —Å–æ—Å–µ–¥–∞ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º Router ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2.2.2.2 –Ω–∞ HQ –∏ 1.1.1.2 –Ω–∞ BR).


–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ NAT –Ω–∞ BR-RTR. –ü–æ –∑–∞–¥–∞–Ω–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é –∞–¥—Ä–µ—Å–æ–≤ (NAT) –Ω–∞ BR-RTR –≤ —Å—Ç–æ—Ä–æ–Ω—É ISP, —á—Ç–æ–±—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –æ—Ñ–∏—Å–µ BR –∏–º–µ–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É.
________________________________________
–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚Ä¢	–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å BR: 192.168.100.0/27
‚Ä¢	–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É ISP: enp0s3
‚Ä¢	–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: enp0s8
________________________________________
–®–∞–≥ 1: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ IP forwarding –≤–∫–ª—é—á—ë–Ω
sudo nano /etc/sysctl.conf
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ:
net.ipv4.ip_forward=1

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å:
sudo sysctl -p
________________________________________
–®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å NAT (–º–∞—Å–∫–∞—Ä–∞–¥)
sudo iptables -t nat -A POSTROUTING -s 192.168.100.0/27 -o enp0s3 -j MASQUERADE
________________________________________
–®–∞–≥ 3: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ iptables
–£—Å—Ç–∞–Ω–æ–≤–∏–º persistent:
sudo apt install iptables-persistent -y
sudo netfilter-persistent save
________________________________________
–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, BR-SRV)
–ù–∞ –º–∞—à–∏–Ω–µ –≤ —Å–µ—Ç–∏ BR (–Ω–∞–ø—Ä–∏–º–µ—Ä, 192.168.100.2):
ping 8.8.8.8        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Ö–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
ping ya.ru          # –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ HQ-SRV
________________________________________
–¶–µ–ª—å:
‚Ä¢	–ü—Ä–∏—Å–≤–æ–∏—Ç—å –∏–º—è
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (VLAN 100)
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSH-–¥–æ—Å—Ç—É–ø –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç
‚Ä¢	–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è sshuser —Å sudo –±–µ–∑ –ø–∞—Ä–æ–ª—è
‚Ä¢	–ü—Ä–æ–ø–∏—Å–∞—Ç—å DNS-—Å—É—Ñ—Ñ–∏–∫—Å, —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –∏ —Ç.–¥.
________________________________________
1. –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
sudo hostnamectl set-hostname hq-srv.au-team.irpo
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤ /etc/hosts:
127.0.1.1 hq-srv.au-team.irpo hq-srv
________________________________________
2. –°–µ—Ç–µ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (VLAN 100)
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è enp0s3 (—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç –æ—Ç HQ-RTR). –ê–¥—Ä–µ—Å –¥–ª—è HQ-SRV ‚Äî 172.16.100.2/26, —à–ª—é–∑ ‚Äî 172.16.100.1.
/etc/netplan/*.yaml

network:
  version: 2
  ethernets:
    enp0s3: {}
  vlans:
    enp0s3.100:
      id: 100
      link: enp0s3
      addresses: [172.16.100.2/26]
      nameservers:
        addresses: [8.8.8.8]
        search: [au-team.irpo]

–í–¢–û–†–û–ô –í–ê–†–ò–ê–ù–¢
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3: {}
  vlans:
    enp0s3.100:
      id: 100
      link: enp0s3
      addresses: [172.16.100.2/26]
      routes:
        - to: 0.0.0.0/0
          via: 172.16.100.1
          on-link: true
      nameservers:
        addresses: [8.8.8.8]
        search: [au-team.irpo]

–ü—Ä–∏–º–µ–Ω–∏–º:

sudo netplan apply
________________________________________
3. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è sshuser
sudo useradd -m -u 1010 -s /bin/bash sshuser
echo "sshuser:P@ssw0rd" | sudo chpasswd

# –î–æ–±–∞–≤–ª—è–µ–º sudo –±–µ–∑ –ø–∞—Ä–æ–ª—è
echo "sshuser ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/sshuser
________________________________________
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH-–¥–æ—Å—Ç—É–ø–∞
–û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç 2024, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø:
sudo apt install openssh-server -y
sudo nano /etc/ssh/sshd_config
–ò–∑–º–µ–Ω—è–µ–º/–¥–æ–±–∞–≤–ª—è–µ–º:
Port 2024
PermitRootLogin no
AllowUsers sshuser
MaxAuthTries 2
Banner /etc/issue.net
–°–æ–∑–¥–∞–µ–º –±–∞–Ω–Ω–µ—Ä:
echo "Authorized access only" | sudo tee /etc/issue.net
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º SSH:
sudo systemctl restart ssh
sudo systemctl enable ssh
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å –¥—Ä—É–≥–æ–≥–æ —É–∑–ª–∞:
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
ssh sshuser@172.16.100.2 -p 2024
________________________________________
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
sudo timedatectl set-timezone Asia/Almaty  # –ò–ª–∏ –¥—Ä—É–≥–æ–π —Å–æ–≥–ª–∞—Å–Ω–æ –º–µ—Å—Ç—É —ç–∫–∑–∞–º–µ–Ω–∞
________________________________________
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –∏ —Å–≤—è–∑–∏
ping hq-rtr.au-team.irpo   # –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS
ping 8.8.8.8               # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

–ü–†–û–ü–ê–õ –ò–ù–¢–ï–†–ù–ï–¢ –ö–ê–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ú–û–ñ–ï–¢ –ë–´–¢–¨
–ü—Ä–æ–±–ª–µ–º–∞: –Ω–∞ HQ-RTR –Ω–µ—Ç NAT (MASQUERADE)
________________________________________
–†–µ—à–µ–Ω–∏–µ: –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å NAT –Ω–∞ HQ-RTR
–í—ã–ø–æ–ª–Ω–∏ –Ω–∞ HQ-RTR:
sudo iptables -t nat -A POSTROUTING -o enp0s3 -j MASQUERADE
(–µ—Å–ª–∏ –≤–Ω–µ—à–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî enp0s3, —á—Ç–æ —É —Ç–µ–±—è –∏ –µ—Å—Ç—å)
–°–æ—Ö—Ä–∞–Ω–∏, –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç:
sudo netfilter-persistent save
________________________________________ –ü—Ä–æ–≤–µ—Ä–∫–∞:
–ù–∞ HQ-RTR:
ping 8.8.8.8
–ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä—å –Ω–∞ HQ-SRV:
ping 8.8.8.8

–ù–∞ HQ-SRV
–í—ã–ø–æ–ª–Ω–∏:
sudo ip route add default via 172.16.100.1 dev enp0s3.100
–ü—Ä–æ–≤–µ—Ä—å:
ip route
–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∞:
default via 172.16.100.1 dev enp0s3.100
________________________________________
–ò —Å—Ä–∞–∑—É:
ping 8.8.8.8
–û–ü–Ø–¢–¨ –ñ–ï –ü–†–û–í–ï–†–Ø–¢–¨ nameserver 8.8.8.8 –≤ /etc/resolv.conf
BR-SRV
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ BR-SRV (—Å–µ—Ä–≤–µ—Ä –≤ –æ—Ñ–∏—Å–µ BR)
________________________________________
üìå –¶–µ–ª—å:
‚Ä¢	–ü—Ä–∏—Å–≤–æ–∏—Ç—å –∏–º—è
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å IP-–∞–¥—Ä–µ—Å –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è gateway4
‚Ä¢	–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è sshuser (UID 1010) —Å –¥–æ—Å—Ç—É–ø–æ–º –ø–æ sudo –±–µ–∑ –ø–∞—Ä–æ–ª—è
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSH-–¥–æ—Å—Ç—É–ø –Ω–∞ –ø–æ—Ä—Ç—É 2024 —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
‚Ä¢	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å
________________________________________
1. –ò–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
sudo hostnamectl set-hostname br-srv.au-team.irpo
–î–æ–±–∞–≤–∏–º –≤ /etc/hosts:
127.0.1.1 br-srv.au-team.irpo br-srv
________________________________________
2. –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
‚Ä¢	IP-–∞–¥—Ä–µ—Å: 192.168.100.2/27
‚Ä¢	VLAN –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–µ—Å–ª–∏ –æ–±—ã—á–Ω—ã–π –ø–æ—Ä—Ç –æ—Ç BR-RTR)
‚Ä¢	–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å: enp0s3
‚Ä¢	–®–ª—é–∑: 192.168.100.1 (–Ω–∞ BR-RTR)
________________________________________
Netplan:
/etc/netplan/*.yaml

network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      addresses: [192.168.100.2/27]
      nameservers:
        addresses: [8.8.8.8]
        search: [au-team.irpo]

–í–¢–û–†–û–ô –í–ê–†–ò–ê–ù–¢

network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      addresses: [192.168.100.2/27]
      nameservers:
        addresses: [8.8.8.8]
        search: [au-team.irpo]
      routes:
        - to: 0.0.0.0/0
          via: 192.168.100.1
          on-link: true
–ü—Ä–∏–º–µ–Ω–∏–º:
sudo netplan apply
________________________________________
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –≤—Ä—É—á–Ω—É—é:
sudo ip route add default via 192.168.100.1 dev enp0s3
–°–¥–µ–ª–∞–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º:
sudo mkdir -p /etc/networkd-dispatch/dormant.d
sudo nano /etc/networkd-dispatch/dormant.d/10-default-route
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
#!/bin/bash
ip route replace default via 192.168.100.1 dev enp0s3
–°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –¥–µ–ª–∞–µ–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
sudo chmod +x /etc/networkd-dispatch/dormant.d/10-default-route
________________________________________
3. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è sshuser
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
sudo useradd -m -u 1010 -s /bin/bash sshuser
echo "sshuser:P@ssw0rd" | sudo chpasswd
echo "sshuser ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/sshuser
________________________________________
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –Ω–∞ –ø–æ—Ä—Ç—É 2024
sudo apt install openssh-server -y
sudo nano /etc/ssh/sshd_config
–ò–∑–º–µ–Ω–∏–º:
Port 2024
PermitRootLogin no
AllowUsers sshuser
MaxAuthTries 2
Banner /etc/issue.net
–°–æ–∑–¥–∞–¥–∏–º –±–∞–Ω–Ω–µ—Ä:
echo "Authorized access only" | sudo tee /etc/issue.net
–ü—Ä–∏–º–µ–Ω–∏–º:
sudo systemctl restart ssh
sudo systemctl enable ssh
________________________________________
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
sudo timedatectl set-timezone Asia/Omsk
________________________________________
6. –ü—Ä–æ–≤–µ—Ä–∫–∞
‚Ä¢	IP: ip a show enp0s3
‚Ä¢	–ü–∏–Ω–≥ : ping 192.168.100.1
‚Ä¢	–ü–∏–Ω–≥ 8.8.8.8
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ HQ-CLI (—Ä–∞–±–æ—á–∞—è —Å—Ç–∞–Ω—Ü–∏—è –≤ VLAN 200)
________________________________________
–¶–µ–ª—å:
‚Ä¢	–ü—Ä–∏—Å–≤–æ–∏—Ç—å –∏–º—è
‚Ä¢	–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ DHCP (—Å VLAN 200)
‚Ä¢	–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ IP, DNS, —à–ª—é–∑–∞
‚Ä¢	–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ DNS-—Ä–µ–∑–æ–ª–≤–∏–Ω–≥
‚Ä¢	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å
‚Ä¢	–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–±–æ—Ç–µ –≤ –¥–æ–º–µ–Ω–µ (–≤ —Å–ª–µ–¥—É—é—â–∏—Ö —ç—Ç–∞–ø–∞—Ö)
________________________________________
1. –ò–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
sudo hostnamectl set-hostname hq-cli.au-team.irpo
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤ /etc/hosts:
127.0.1.1 hq-cli.au-team.irpo hq-cli
________________________________________
2. –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
‚Ä¢	–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ VLAN 200 ‚Üí IP –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å—Å—è –ø–æ DHCP
‚Ä¢	–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å: enp0s3, VLAN ‚Üí enp0s3.200
Netplan:
/etc/netplan/*.yaml

network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3: {}
  vlans:
    enp0s3.200:
      id: 200
      link: enp0s3
      dhcp4: true
–ü—Ä–∏–º–µ–Ω–∏–º:
sudo netplan apply
________________________________________
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ DHCP –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
ip a show enp0s3.200
ip route
cat /etc/resolv.conf
–û–∂–∏–¥–∞–µ–º–æ–µ:
‚Ä¢	IP –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞: 172.16.100.66 - 172.16.100.78
‚Ä¢	–®–ª—é–∑: 172.16.100.65
‚Ä¢	DNS: 172.16.100.2
‚Ä¢	DNS-—Å—É—Ñ—Ñ–∏–∫—Å: au-team.irpo (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
________________________________________
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏
ping 172.16.100.65       # HQ-RTR
ping 172.16.100.2        # HQ-SRV
ping 8.8.8.8             # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç
ping ya.ru               # –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
________________________________________
5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
sudo timedatectl set-timezone Asia/Omsk

–û—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è ‚Äî –ú–æ–¥—É–ª—å 1 (–ö–û–î 09.02.06-1-2025)
1. –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É —Å HQ-RTR –∏–ª–∏ BR-RTR
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: ping 8.8.8.8 –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç, apt –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
1.	–ü—Ä–æ–≤–µ—Ä—å –º–∞—Ä—à—Ä—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: ip route
2.	–ï—Å–ª–∏ –Ω–µ—Ç default via, –¥–æ–±–∞–≤—å –≤—Ä—É—á–Ω—É—é:
3.	  sudo ip route add default via 172.16.4.1 dev enp0s3  # HQ-RTR
4.	  sudo ip route add default via 172.16.5.1 dev enp0s3  # BR-RTR
5.	–ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª /etc/resolv.conf –∏ –ø—Ä–æ–ø–∏—à–∏: nameserver 8.8.8.8
2. HQ-CLI –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç IP –ø–æ DHCP
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: ip a –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–¥—Ä–µ—Å, –Ω–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ç—å—é
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
6.	–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ DHCP-—Å–µ—Ä–≤–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: sudo systemctl status isc-dhcp-server
7.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ –æ–Ω —Å–ª—É—à–∞–µ—Ç –Ω—É–∂–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (enp0s8.200) –≤ /etc/default/isc-dhcp-server
8.	–ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ /etc/dhcp/dhcpd.conf ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω, –º–∞—Å–∫–∞, —à–ª—é–∑
9.	–ü—Ä–æ–≤–µ—Ä—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ VLAN 200 –Ω–∞ HQ-RTR –∏ HQ-CLI
3. OSPF –Ω–µ –æ–±–º–µ–Ω–∏–≤–∞–µ—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç–∞–º–∏
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: –Ω–µ—Ç —Å–æ—Å–µ–¥–µ–π ospf, –º–∞—Ä—à—Ä—É—Ç—ã –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
10.	–ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å FRR: sudo systemctl status frr
11.	–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ /etc/frr/daemons ospfd=yes
12.	–í vtysh –ø—Ä–æ–≤–µ—Ä—å: show ip ospf neighbor ‚Äî —Å–æ—Å–µ–¥–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
13.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ GRE-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–¥–Ω—è—Ç –∏ –∞–¥—Ä–µ—Å–∞ –Ω–∞ –Ω–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω—ã
4. –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç NAT (–Ω–µ—Ç –≤—ã—Ö–æ–¥–∞ –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ç–µ–π –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç)
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–∏–Ω–≥–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä, –Ω–æ –Ω–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
14.	–ü—Ä–æ–≤–µ—Ä—å, –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏ iptables MASQUERADE –Ω–∞ ISP:
15.	  sudo iptables -t nat -L -n -v
16.	–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤—å: sudo iptables -t nat -A POSTROUTING -o enp0s3 -j MASQUERADE
17.	–°–æ—Ö—Ä–∞–Ω–∏ –ø—Ä–∞–≤–∏–ª–∞: sudo netfilter-persistent save
5. HQ-SRV –∏–ª–∏ BR-SRV –Ω–µ –ø–∏–Ω–≥—É–µ—Ç—Å—è
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: –ù–µ—Ç –ø–∏–Ω–≥–∞ –æ—Ç –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –¥–∞–∂–µ —Å RTR
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
18.	–ü—Ä–æ–≤–µ—Ä—å VLAN ID –∏ IP-–∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, HQ-SRV –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ VLAN 100 —Å IP 172.16.100.2/26)
19.	–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ netplan –∞–∫—Ç–∏–≤–µ–Ω –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–ø–∏—Å–∞–Ω
20.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ –º–∞—Ä—à—Ä—É—Ç –¥–æ VLAN –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ HQ-RTR: show ip route
21.	–ü–æ–ø—Ä–æ–±—É–π –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å ufw: sudo ufw disable (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
6. –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –ø–æ SSH –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç (2024)
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: Connection refused –∏–ª–∏ Permission denied
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
22.	–ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é /etc/ssh/sshd_config: Port 2024, AllowUsers sshuser
23.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Å–ª—É–∂–±–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç: sudo systemctl status ssh
24.	–ü—Ä–æ–≤–µ—Ä—å iptables: –ø–æ—Ä—Ç 2024 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑—Ä–µ—à—ë–Ω
25.	–ü–æ–ø—Ä–æ–±—É–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –∫–ª–∏–µ–Ω—Ç–∞: ssh sshuser@172.16.100.2 -p 2024
7. –í HQ-RTR –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è VLAN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: –ü–æ—Å–ª–µ netplan apply –Ω–µ—Ç enp0s8.100 –∏ –¥—Ä—É–≥–∏—Ö VLAN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
26.	–ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é netplan ‚Äî —É–±–µ–¥–∏—Å—å, —á—Ç–æ enp0s8 —É–∫–∞–∑–∞–Ω –≤ ethernets –∏ link –≤ vlans —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ–≥–æ
27.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ ID VLAN –≤–µ—Ä–Ω—ã–π (100, 200, 999) –∏ –Ω–µ –ø–µ—Ä–µ–ø—É—Ç–∞–Ω —Å IP
28.	–ü—Ä–æ–≤–µ—Ä—å –æ—à–∏–±–∫–∏: sudo journalctl -xe | grep netplan
8. HQ-SRV –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
‚Ä¢	‚ùó –°–∏–º–ø—Ç–æ–º: ping 8.8.8.8 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–∏ —ç—Ç–æ–º HQ-RTR –¥–æ—Å—Ç—É–ø–µ–Ω
‚Ä¢	‚úÖ –†–µ—à–µ–Ω–∏–µ:
29.	–ü—Ä–æ–≤–µ—Ä—å –º–∞—Ä—à—Ä—É—Ç –Ω–∞ HQ-SRV: ip route
30.	–ï—Å–ª–∏ –Ω–µ—Ç default ‚Äî –¥–æ–±–∞–≤—å: sudo ip route add default via 172.16.100.1 dev enp0s3.100
31.	–ü—Ä–æ–≤–µ—Ä—å /etc/resolv.conf ‚Äî –¥–æ–±–∞–≤—å nameserver 8.8.8.8

